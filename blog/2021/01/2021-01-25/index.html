<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Scheduling Jobs for Maximum Efficiency - Part 1 - Matthew Crews</title><meta name=Description content="Hugo theme - LoveIt"><meta property="og:title" content="Scheduling Jobs for Maximum Efficiency - Part 1"><meta property="og:description" content="I was recently having a discussion with a friend when they brought up a new problem they were looking into. He asked me if it was a good candidate for Mathematical Planning and I said, &ldquo;Absolutely!&rdquo; I am abstracting away the specific domain, but this is the essence of the problem.
There are a set of machines which can process jobs. The jobs are of different types and sizes. There are three job-types: A, B, and C."><meta property="og:type" content="article"><meta property="og:url" content="https://matthewcrews.com/blog/2021/01/2021-01-25/"><meta property="og:image" content="https://matthewcrews.com/logo.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-01-25T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-05T00:01:17-07:00"><meta property="og:site_name" content="Matthew Crews"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://matthewcrews.com/logo.png"><meta name=twitter:title content="Scheduling Jobs for Maximum Efficiency - Part 1"><meta name=twitter:description content="I was recently having a discussion with a friend when they brought up a new problem they were looking into. He asked me if it was a good candidate for Mathematical Planning and I said, &ldquo;Absolutely!&rdquo; I am abstracting away the specific domain, but this is the essence of the problem.
There are a set of machines which can process jobs. The jobs are of different types and sizes. There are three job-types: A, B, and C."><meta name=application-name content="Mathew Crews"><meta name=apple-mobile-web-app-title content="Mathew Crews"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://matthewcrews.com/blog/2021/01/2021-01-25/><link rel=prev href=https://matthewcrews.com/blog/2021/01/2021-01-11/><link rel=next href=https://matthewcrews.com/blog/2021/01/2021-01-28/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Scheduling Jobs for Maximum Efficiency - Part 1","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/matthewcrews.com\/blog\/2021\/01\/2021-01-25\/"},"image":[{"@type":"ImageObject","url":"https:\/\/matthewcrews.com\/images\/Apple-Devices-Preview.png","width":3200,"height":2048}],"genre":"blog","wordcount":2693,"url":"https:\/\/matthewcrews.com\/blog\/2021\/01\/2021-01-25\/","datePublished":"2021-01-25T00:00:00+00:00","dateModified":"2023-05-05T00:01:17-07:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/matthewcrews.com\/images\/fast_fsharp_avatar.png"},"author":{"@type":"Person","name":"Matthew Crews"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Matthew Crews">Matthew Crews</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/blog/>Blog </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/matthewcrews/blog title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Matthew Crews">Matthew Crews</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/blog/ title>Blog</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/matthewcrews/blog title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster">Scheduling Jobs for Maximum Efficiency - Part 1</h1><div class=content id=content><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube-nocookie.com/embed/2n7nAyoEzGs style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><p>I was recently having a discussion with a friend when they brought up a new problem they were looking into. He asked me if it was a good candidate for Mathematical Planning and I said, &ldquo;Absolutely!&rdquo; I am abstracting away the specific domain, but this is the essence of the problem.</p><p>There are a set of machines which can process jobs. The jobs are of different types and sizes. There are three job-types: A, B, and C. Each machine has different job-types that it can process. Some machines can process any job-type while other machines can only work on one or two. At the beginning of the day, we are given a set of jobs to assign to the machines. We want to assign jobs to machines such that a) the machines are evenly loaded and b) we minimize the number of different job-types each machine must process.</p><p>An ideal plan would have each machine with the same amount of work and only processing a single job-type. The reason we want a machine to only process a single job-type is to minimize the waste associated with changing between job-types. Switching between job-types is fast, it just creates unwanted waste. Let&rsquo;s start with creating a small domain model and generate some example data.</p><blockquote><p><strong>Note</strong>: You can find the full code example for this post <a href=https://github.com/matthewcrews/modelmondays/blob/main/2021-01-22-MachineAllocation/2021-01-22-MachineAllocation.fsx target=_blank rel="noopener noreffer">here</a></p></blockquote><h2 id=a-domain-for-job-assignments>A Domain for Job Assignments</h2><p>Based on the description there are some clear types that we need to define: <code>Machine</code>, <code>Job</code>, and <code>JobType</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=o>[&lt;</span><span class=n>RequireQualifiedAccess</span><span class=o>&gt;]</span>
</span></span><span class=line><span class=cl><span class=k>type</span> <span class=nc>JobType</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>A</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>B</span>
</span></span><span class=line><span class=cl>    <span class=o>|</span> <span class=n>C</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>type</span> <span class=nc>Job</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Id</span> <span class=o>:</span> <span class=n>int</span>
</span></span><span class=line><span class=cl>    <span class=n>JobType</span> <span class=o>:</span> <span class=n>JobType</span>
</span></span><span class=line><span class=cl>    <span class=n>Size</span> <span class=o>:</span> <span class=kt>float</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>with</span>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=n>this</span><span class=p>.</span><span class=nf>ToString</span> <span class=bp>()</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=s>&#34;Job_{this.Id}&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>type</span> <span class=nc>Machine</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Id</span> <span class=o>:</span> <span class=n>int</span>
</span></span><span class=line><span class=cl>    <span class=n>JobTypes</span> <span class=o>:</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>JobType</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>with</span>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=n>this</span><span class=p>.</span><span class=nf>ToString</span> <span class=bp>()</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=s>&#34;Machine_{this.Id}&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>I like to override the <code>ToString</code> method because the <code>ConstraintBuilder</code> and <code>DecisionBuilder</code> in <code>Flips</code> use <code>ToString</code> for the naming of constraints and decisions. <code>JobType</code> is a straightforward Discriminated Union with three different cases <code>A</code>, <code>B</code>, and <code>C</code>. <code>Job</code> has an <code>Id</code> field for identifying a particular <code>Job</code>, a <code>JobType</code> which describes the type of job that it is, and the <code>Size</code>.</p><p>The <code>Machine</code> type has an <code>Id</code> field and a <code>JobTypes</code> field. The <code>JobTypes</code> field is a <code>Set</code> of <code>JobType</code>. This represents the jobs the <code>Machine</code> can process.</p><p>We now want to setup some data for us to be able to play with. These will be the parameters which will help us generate random data for us to work with.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// Set of JobTypes for iterating over and sampling from
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>jobTypes</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl>    <span class=o>[|</span>
</span></span><span class=line><span class=cl>        <span class=nn>JobType</span><span class=p>.</span><span class=n>A</span>
</span></span><span class=line><span class=cl>        <span class=nn>JobType</span><span class=p>.</span><span class=n>B</span>
</span></span><span class=line><span class=cl>        <span class=nn>JobType</span><span class=p>.</span><span class=n>C</span>
</span></span><span class=line><span class=cl>    <span class=o>|]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Some theoretical JobTypeSets to be used in generating
</span></span></span><span class=line><span class=cl><span class=c1>// random Machines
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>jobTypeSets</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=o>[|</span>
</span></span><span class=line><span class=cl>        <span class=n>Set</span> <span class=n>jobTypes</span>
</span></span><span class=line><span class=cl>        <span class=n>Set</span> <span class=n>jobTypes</span><span class=o>.[</span><span class=mi>1</span><span class=o>..]</span>
</span></span><span class=line><span class=cl>        <span class=n>Set</span> <span class=n>jobTypes</span><span class=o>.[..</span><span class=mi>1</span><span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>|]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Setting up parameters for the example
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>rng</span> <span class=o>=</span> <span class=nn>System</span><span class=p>.</span><span class=n>Random</span><span class=o>(</span><span class=mi>123</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>numberOfJobs</span> <span class=o>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>numberOfMachines</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>minJobSize</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>maxJobSize</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>maxWorkDifference</span> <span class=o>=</span> <span class=mi>2</span><span class=o>.</span><span class=mi>0</span>
</span></span></code></pre></td></tr></table></div></div><p><code>jobTypes</code> is an <code>Array</code> which holds each of the possible <code>JobType</code> cases. We will use this to create random jobs. The <code>jobTypeSets</code> value is an <code>Array</code> of <code>Set&lt;JobType></code>. These are the possible values for the <code>JobTypes</code> field of <code>Machine</code> that we will use for generating random machines. For this example, we will have 20 jobs and 5 machines to assign them to. <code>minJobSize</code> will control how small a job can be and <code>maxJobSize</code> will determine how large. The <code>maxWorkDifference</code> parameter will determine how different the loading of machines that we will allow.</p><p>We now create some convenience functions for generating random data. We will also add a function for looking up a key in a <code>Map</code> but returning a default value when the key is not present.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>randomJobSize</span> <span class=o>(</span><span class=n>rng</span><span class=o>:</span> <span class=nn>System</span><span class=p>.</span><span class=n>Random</span><span class=o>)</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>rng</span><span class=o>.</span><span class=n>Next</span><span class=o>(</span><span class=n>minJobSize</span><span class=o>,</span> <span class=n>maxJobSize</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=kt>float</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>randomJobType</span> <span class=o>(</span><span class=n>rng</span><span class=o>:</span> <span class=nn>System</span><span class=p>.</span><span class=n>Random</span><span class=o>)</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>jobTypes</span><span class=o>.[</span><span class=n>rng</span><span class=o>.</span><span class=n>Next</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=n>jobTypes</span><span class=o>.</span><span class=n>Length</span><span class=o>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>randomJobTypeSet</span> <span class=o>(</span><span class=n>rng</span><span class=o>:</span> <span class=nn>System</span><span class=p>.</span><span class=n>Random</span><span class=o>)</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>jobTypeSets</span><span class=o>.[</span><span class=n>rng</span><span class=o>.</span><span class=n>Next</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=n>jobTypeSets</span><span class=o>.</span><span class=n>Length</span><span class=o>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>module</span> <span class=nn>Map</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Useful when you want to look up a key in a Map but you want it to provide
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// a default value if the key is missing
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>let</span> <span class=nv>tryFindDefault</span> <span class=o>(</span><span class=n>key</span><span class=o>:</span> <span class=k>&#39;</span><span class=n>a</span><span class=o>)</span> <span class=o>(</span><span class=n>defaultValue</span><span class=o>:</span> <span class=k>&#39;</span><span class=n>v</span><span class=o>)</span> <span class=o>(</span><span class=n>m</span><span class=o>:</span> <span class=n>Map</span><span class=o>&lt;</span><span class=k>&#39;</span><span class=n>a</span><span class=o>,</span> <span class=k>&#39;</span><span class=n>v</span><span class=o>&gt;)</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=nn>Map</span><span class=p>.</span><span class=n>tryFind</span> <span class=n>key</span> <span class=n>m</span> <span class=k>with</span>
</span></span><span class=line><span class=cl>        <span class=o>|</span> <span class=n>Some</span> <span class=n>v</span> <span class=o>-&gt;</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>        <span class=o>|</span> <span class=n>None</span> <span class=o>-&gt;</span> <span class=n>defaultValue</span>
</span></span></code></pre></td></tr></table></div></div><p>We can now generate a random set of jobs and machines to work with.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// Create some examples jobs
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>jobs</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=o>[</span><span class=mi>1</span><span class=o>..</span><span class=n>numberOfJobs</span><span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>List</span><span class=p>.</span><span class=n>map</span> <span class=o>(</span><span class=k>fun</span> <span class=n>id</span> <span class=o>-&gt;</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl>        <span class=n>Id</span> <span class=o>=</span> <span class=n>id</span>
</span></span><span class=line><span class=cl>        <span class=n>JobType</span> <span class=o>=</span> <span class=n>randomJobType</span> <span class=n>rng</span>
</span></span><span class=line><span class=cl>        <span class=n>Length</span> <span class=o>=</span> <span class=n>randomJobSize</span> <span class=n>rng</span> 
</span></span><span class=line><span class=cl>    <span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create some test machines
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>machines</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=o>[</span><span class=mi>1</span><span class=o>..</span><span class=n>numberOfMachines</span><span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>List</span><span class=p>.</span><span class=n>map</span> <span class=o>(</span><span class=k>fun</span> <span class=n>id</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Id</span> <span class=o>=</span> <span class=n>id</span>
</span></span><span class=line><span class=cl>        <span class=n>JobTypes</span> <span class=o>=</span> <span class=n>randomJobTypeSet</span> <span class=n>rng</span>
</span></span><span class=line><span class=cl>    <span class=o>})</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=formulating-the-problem>Formulating the Problem</h2><p>Now that we have some data to work with, we can get to formulating our model. Let&rsquo;s go ahead and open <code>Flips</code>. I love working with VS Code, Ionide, and <code>.fsx</code> files for this kind of exploration. The new <code>#r "nuget: &lt;library name>"</code> syntax for using Nuget packages has been a game changer.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=cp>#r</span> <span class=s>&#34;nuget: Flips&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>open</span> <span class=nn>Flips</span>
</span></span><span class=line><span class=cl><span class=k>open</span> <span class=nn>Flips.Types</span>
</span></span><span class=line><span class=cl><span class=k>open</span> <span class=nn>Flips.SliceMap</span>
</span></span></code></pre></td></tr></table></div></div><p>We want to create a <code>Map</code> where they key is a <code>JobType</code> and the value is a list of <code>Job</code> that are of that type. This will make it easy for us to lookup the <code>Job</code>s of a given type.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// A Map from JobType to the Jobs which are of that type
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>jobsForJobType</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>jobs</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>List</span><span class=p>.</span><span class=n>groupBy</span> <span class=o>(</span><span class=k>fun</span> <span class=n>job</span> <span class=o>-&gt;</span> <span class=n>job</span><span class=o>.</span><span class=n>JobType</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=n>Map</span>
</span></span></code></pre></td></tr></table></div></div><p>We now want to create a 1-dimensional <code>SliceMap</code> where the <code>'key</code> is a <code>Job</code> and the <code>'value</code> is the size of the job. This will make it easy for us to sum up how much work has been assigned to a <code>Machine</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// A SliceMap where the key is a Job and the value is the size of the Job
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>jobSizes</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>jobs</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>List</span><span class=p>.</span><span class=n>map</span> <span class=o>(</span><span class=k>fun</span> <span class=n>job</span> <span class=o>-&gt;</span> <span class=n>job</span><span class=o>,</span> <span class=n>job</span><span class=o>.</span><span class=n>Size</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=n>SMap</span>
</span></span></code></pre></td></tr></table></div></div><p>Now let&rsquo;s create the set of <code>Decision</code>s which will represent us assigning a <code>Job</code> to a <code>Machine</code>. We will store this in a 3-dimensional <code>SliceMap</code> keyed by the <code>Machine</code>, the <code>JobType</code>, and finally the <code>Job</code>. The reason we key by the <code>JobType</code> will become apparent later in the formulation. We will use a <code>Boolean</code> decision where <code>1.0</code> indicates that we are assigning the <code>Job</code> to a <code>Machine</code> and <code>0.0</code> indicates not.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// The Decisions which represent assigning a Job to a Machine
</span></span></span><span class=line><span class=cl><span class=c1>// The JobType index allows us to slice along the job type
</span></span></span><span class=line><span class=cl><span class=c1>// which is useful in some of the constraints
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>assignments</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>DecisionBuilder</span> <span class=s>&#34;Assignment&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>machine</span> <span class=k>in</span> <span class=n>machines</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>jobType</span> <span class=k>in</span> <span class=n>machine</span><span class=o>.</span><span class=n>JobTypes</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>job</span> <span class=k>in</span> <span class=nn>Map</span><span class=p>.</span><span class=n>tryFindDefault</span> <span class=n>jobType</span> <span class=bp>[]</span> <span class=n>jobsForJobType</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>Boolean</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=o>|&gt;</span> <span class=n>SMap3</span>
</span></span></code></pre></td></tr></table></div></div><p>Now that we have these decisions which represent assigning a job to a machine, we can formulate our first and most obvious constraints. Each job must be assigned to one machine. For each job we say that the sum of <code>assignments</code> for a given <code>job</code> across all machines and all job-types must be <code>1.0</code>. This forces the solver to find a solution where each <code>job</code> is assigned once.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// Each job must be assigned
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>jobsAssignmentConstraints</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>ConstraintBuilder</span> <span class=s>&#34;JobAssignment&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>job</span> <span class=k>in</span> <span class=n>jobs</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>sum</span> <span class=n>assignments</span><span class=o>.[</span><span class=n>All</span><span class=o>,</span> <span class=n>All</span><span class=o>,</span> <span class=n>job</span><span class=o>]</span> <span class=o>==</span> <span class=mi>1</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=constraint-or-objective>Constraint or Objective?</h2><p>We now come to an interesting question. Our original problem statement said that we want to minimize the number of different job-types a machine must deal with. Ideally each machine only works on a single job-type. We also said that we want the machines evenly loaded. When I was chatting with my friend I dug into this point. Which one of these objectives is more important because we can&rsquo;t optimize for both? This is where a modeler needs to work with their client to help them understand what the most important thing is truly.</p><p>In our case, minimizing the different job-types for machines was the most important, so long as the machines were not too unevenly loaded. This means that the goal for even loading becomes a constraint and the objective remains the minimization of different job-types for machines. We will explore variations of this problem in future posts.</p><h2 id=controlling-the-difference-in-loading>Controlling the Difference in Loading</h2><p>Now that we have decided that even machine loading needs to be a constraint, we need to create some <code>Decision</code>s to control for it. We will create two <code>Decision</code>s. One will represent the value of the machine with the greatest loading and the other the machine with the least loading.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// A Decision which is meant to represent the MaxWork value across all Machines
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>maxWork</span> <span class=o>=</span> <span class=nn>Decision</span><span class=p>.</span><span class=n>createContinuous</span> <span class=s>&#34;MaxWork&#34;</span> <span class=mi>0</span><span class=o>.</span><span class=mi>0</span> <span class=n>infinity</span>
</span></span><span class=line><span class=cl><span class=c1>// A Decision which is meant to represent the MinWork value across all Machines
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>minWork</span> <span class=o>=</span> <span class=nn>Decision</span><span class=p>.</span><span class=n>createContinuous</span> <span class=s>&#34;MinWork&#34;</span> <span class=mi>0</span><span class=o>.</span><span class=mi>0</span> <span class=n>infinity</span>
</span></span></code></pre></td></tr></table></div></div><p>Now, we want to create a <code>Constraint</code> which states that the difference between these two values is not greater than the maximum allowed difference.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// We constrain the difference between the most heavily loaded machine
</span></span></span><span class=line><span class=cl><span class=c1>// and the least loaded
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>maxWorkDifferenceConstraint</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nn>Constraint</span><span class=p>.</span><span class=n>create</span> <span class=s>&#34;MaxWorkDifferent&#34;</span> <span class=o>(</span><span class=n>maxWork</span> <span class=o>-</span> <span class=n>minWork</span> <span class=o>&lt;==</span> <span class=n>maxWorkDifference</span><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Okay, that&rsquo;s great but will it do anything? Right now, there is nothing that forces the <code>maxWork</code> decision to be equal to the loading of the most heavily loaded machine. There&rsquo;s also nothing which forces <code>minWork</code> to be equal to the loading of the most lightly loaded machine. The solver could set the values to <code>0.0</code> and be done with it. We need to create some constraints which will force <code>maxWork</code> and <code>minWork</code> to take on the loading of the most heavily and most lightly loaded machines.</p><p>Let&rsquo;s create some constraints which state that the value of the <code>maxWork</code> decision must be greater than or equal to the loading of all the machines. This will force it to be a value above or equal to the maximum loading.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// The maxWork Decision must be greater or equal to all of the total work
</span></span></span><span class=line><span class=cl><span class=c1>// for each Machine
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>maxWorkConstraints</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>ConstraintBuilder</span> <span class=s>&#34;MaxWork&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>machine</span> <span class=k>in</span> <span class=n>machines</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>maxWork</span> <span class=o>&gt;==</span> <span class=n>sum</span> <span class=o>(</span><span class=n>assignments</span><span class=o>[</span><span class=n>machine</span><span class=o>,</span> <span class=n>All</span><span class=o>,</span> <span class=n>All</span><span class=o>]</span> <span class=o>.*</span> <span class=n>jobSizes</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>We do a similar thing for the <code>minWork</code> decision. In this case we will say that <code>minWork</code> must be less than or equal to all the loadings of the machines.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// The minWork Decision must be less or equal to all of the total work
</span></span></span><span class=line><span class=cl><span class=c1>// for each Machine
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>minWorkConstraints</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>ConstraintBuilder</span> <span class=s>&#34;MinWork&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>machine</span> <span class=k>in</span> <span class=n>machines</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>minWork</span> <span class=o>&lt;==</span> <span class=n>sum</span> <span class=o>(</span><span class=n>assignments</span><span class=o>[</span><span class=n>machine</span><span class=o>,</span> <span class=n>All</span><span class=o>,</span> <span class=n>All</span><span class=o>]</span> <span class=o>.*</span> <span class=n>jobSizes</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>maxWorkConstraints</code> and <code>minWorkConstraints</code> will force <code>maxWork</code> and <code>minWork</code> to take on the values of the most heavily and lightly loaded machines respectively. <code>maxWorkDifferenceConstraint</code> states that the difference between <code>maxWork</code> and <code>minWork</code> must be within the permissable bounds. All together these constraints will prevent the solver from distributing jobs across machines unevenly.</p><h2 id=minimizing-the-job-types-for-machines>Minimizing the Job-Types for Machines</h2><p>We now need to quantify how many different job-types are being assigned to machines. To do this, we will create a set of <code>Boolean</code> decisions which will indicate whether we have decided to assign a job of a given job-type to a machine. We will store these in a 2-dimensional <code>SliceMap</code> where the keys are the <code>Machine</code> and the <code>JobType</code>. <code>1</code> will represent that we have decided to assign a given <code>JobType</code> to a <code>Machine</code>. <code>0</code> will indicate that we did not. I like to think of this as &ldquo;turning on&rdquo; or &ldquo;turning off&rdquo; the job-type for the machine. We will call these decisions the <code>setups</code> decisions.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// A Decision which indicates whether we setup a given Machine for a 
</span></span></span><span class=line><span class=cl><span class=c1>// JobType at any point
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>setups</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>DecisionBuilder</span> <span class=s>&#34;Setups&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>machine</span> <span class=k>in</span> <span class=n>machines</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>jobType</span> <span class=k>in</span> <span class=n>jobTypes</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>Boolean</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=o>|&gt;</span> <span class=n>SMap2</span>
</span></span></code></pre></td></tr></table></div></div><p>We now want to create some constraints which will force the solver to turn on the decision to allow the assigning of a job-type to a machine. We will do this by saying that the sum of jobs of a given job-type must be less than or equal to our decision to assign that job-type to the machine multiplied by a large number. This will force the solver to &ldquo;turn on&rdquo; the job-type for the machine. In our case the &ldquo;large number&rdquo; will be the total number of jobs.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// We must turn the setups value for a given Machine and JobType to 1
</span></span></span><span class=line><span class=cl><span class=c1>// if we assign a Job of the given JobType to the Machine
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>setupConstraints</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>ConstraintBuilder</span> <span class=s>&#34;SetupRequired&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>machine</span> <span class=k>in</span> <span class=n>machines</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>jobType</span> <span class=k>in</span> <span class=n>jobTypes</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>sum</span> <span class=o>(</span><span class=n>assignments</span><span class=o>[</span><span class=n>machine</span><span class=o>,</span> <span class=n>jobType</span><span class=o>,</span> <span class=n>All</span><span class=o>])</span> <span class=o>&lt;==</span> <span class=o>(</span><span class=kt>float</span> <span class=n>numberOfJobs</span><span class=o>)</span> <span class=o>*</span> <span class=n>setups</span><span class=o>[</span><span class=n>machine</span><span class=o>,</span> <span class=n>jobType</span><span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>We can now create an expression which represents the number of different job-types that are assigned to machines.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// An expression which is the sum of the Setups that will need to be performed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>numberSetupsExpression</span> <span class=o>=</span> <span class=n>sum</span> <span class=n>setups</span>
</span></span></code></pre></td></tr></table></div></div><p>We use this expression to create our objective of minimizing the number of different job-types assigned to a machine.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// We want to minimize the number of setups
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>minSetupsObjective</span> <span class=o>=</span> <span class=nn>Objective</span><span class=p>.</span><span class=n>create</span> <span class=s>&#34;MinSetups&#34;</span> <span class=n>Minimize</span> <span class=n>numberSetupsExpression</span>
</span></span></code></pre></td></tr></table></div></div><p>We can now compose our model from the parts that we have created.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// Compose the model
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>model</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nn>Model</span><span class=p>.</span><span class=n>create</span> <span class=n>minSetupsObjective</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>jobsAssignmentConstraints</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>maxWorkConstraints</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>minWorkConstraints</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraint</span> <span class=n>maxWorkDifferenceConstraint</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>setupConstraints</span>
</span></span></code></pre></td></tr></table></div></div><p>We now ask the solver to find us a solution.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// Give the solver plenty of time to find a solution
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>settings</span> <span class=o>=</span> <span class=o>{</span> <span class=nn>Settings</span><span class=p>.</span><span class=n>basic</span> <span class=k>with</span> <span class=n>MaxDuration</span> <span class=o>=</span> <span class=mi>60_000L</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>result</span> <span class=o>=</span> <span class=nn>Solver</span><span class=p>.</span><span class=n>solve</span> <span class=n>settings</span> <span class=n>model</span>
</span></span></code></pre></td></tr></table></div></div><p>If you want to see the code that prints out the results you can check it out <a href=https://github.com/matthewcrews/modelmondays/blob/260d21184df7f5803a4c6a72ba13e8b61db4962d/2021-01-22-MachineAllocation/2021-01-22-MachineAllocation.fsx#L195 target=_blank rel="noopener noreffer">here</a>. This is the solution the solver found.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Assignments:
</span></span><span class=line><span class=cl>Machine: 1
</span></span><span class=line><span class=cl>        Job: 4
</span></span><span class=line><span class=cl>        Job: 7
</span></span><span class=line><span class=cl>        Job: 8
</span></span><span class=line><span class=cl>        Job: 11
</span></span><span class=line><span class=cl>Machine: 2
</span></span><span class=line><span class=cl>        Job: 16
</span></span><span class=line><span class=cl>        Job: 18
</span></span><span class=line><span class=cl>        Job: 20
</span></span><span class=line><span class=cl>Machine: 3
</span></span><span class=line><span class=cl>        Job: 1
</span></span><span class=line><span class=cl>        Job: 3
</span></span><span class=line><span class=cl>        Job: 6
</span></span><span class=line><span class=cl>        Job: 12
</span></span><span class=line><span class=cl>        Job: 17
</span></span><span class=line><span class=cl>        Job: 19
</span></span><span class=line><span class=cl>Machine: 4
</span></span><span class=line><span class=cl>        Job: 2
</span></span><span class=line><span class=cl>        Job: 13
</span></span><span class=line><span class=cl>        Job: 14
</span></span><span class=line><span class=cl>Machine: 5
</span></span><span class=line><span class=cl>        Job: 5
</span></span><span class=line><span class=cl>        Job: 9
</span></span><span class=line><span class=cl>        Job: 10
</span></span><span class=line><span class=cl>        Job: 15
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Machine Loading:
</span></span><span class=line><span class=cl>Machine: 1 | Total Load: 5
</span></span><span class=line><span class=cl>Machine: 2 | Total Load: 5
</span></span><span class=line><span class=cl>Machine: 3 | Total Load: 7
</span></span><span class=line><span class=cl>Machine: 4 | Total Load: 6
</span></span><span class=line><span class=cl>Machine: 5 | Total Load: 6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Max Diffence In Loading: 2
</span></span></code></pre></td></tr></table></div></div><h2 id=next-steps>Next Steps</h2><p>We&rsquo;ve only begone to explore this model. There are quite a few variations and nuances that I will dive into in the posts to come. In the future we will discuss adding machine capacity and dealing with infeasible models. We will also explore adding restrictions on just how much of a job-type can be assigned to a given machine. Some job-types cause more wear and therefore we do not want too much assigned to a single machine. We will also look at needing to re-plan part way through the day and look at scheduling over a longer time horizon.</p><p>These types of scheduling problems are common and therefore it&rsquo;s valuable for us to explore how we can play and tweak with this model to make it suit our needs. Feel free to reach out with questions and ideas for modeling challenges in the future!</p><p>Please send me an email at <a href=mailto:matthewcrews@gmail.com rel>matthewcrews@gmail.com</a> if you have any questions and subscribe so you can stay on top new posts and products I am offering.</p><script>window.mootrack||!function(e,t,n,s,o){function i(e){var s,o=~~(Date.now()/3e5),t=document.createElement(n);t.async=!0,t.src=e+"?ts="+o,s=document.getElementsByTagName(n)[0],s.parentNode.insertBefore(t,s)}e.MooTrackerObject=o,e[o]=e[o]||function(){return e[o].q?void e[o].q.push(arguments):void(e[o].q=[arguments])},window.attachEvent?window.attachEvent("onload",i.bind(this,s)):window.addEventListener("load",i.bind(this,s),!1)}(window,document,"script","https://cdn.stat-track.com/statics/moosend-tracking.min.js","mootrack"),mootrack("loadForm","b498d29aaba84b5bb3e0479003dc7264")</script><div data-mooform-id=b498d29a-aba8-4b5b-b3e0-479003dc7264></div></div><div id=comments></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=matthewcrews.com target=_blank>Matthew Crews</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"PASDMWALPK",algoliaIndex:"index.en",algoliaSearchKey:"b42948e51daaa93df92381c8e2ac0f93",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>