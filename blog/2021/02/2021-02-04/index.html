<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Scheduling Jobs for Maximum Efficiency - Part 3 - Matthew Crews</title><meta name=Description content="Hugo theme - LoveIt"><meta property="og:title" content="Scheduling Jobs for Maximum Efficiency - Part 3"><meta property="og:description" content="I&rsquo;ve continued to consult with my friend on the job assignments problem that I have been discussing in post 1 and post 2. At first, he was excited about what we had come up with but I knew there were likely more complexities that had not been uncovered yet. He went back to the client and came away with some new information. He told me, &ldquo;Mathew, it turns out that machines have limited capacity."><meta property="og:type" content="article"><meta property="og:url" content="https://matthewcrews.com/blog/2021/02/2021-02-04/"><meta property="og:image" content="https://matthewcrews.com/logo.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-02-03T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-08T10:51:36-07:00"><meta property="og:site_name" content="Matthew Crews"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://matthewcrews.com/logo.png"><meta name=twitter:title content="Scheduling Jobs for Maximum Efficiency - Part 3"><meta name=twitter:description content="I&rsquo;ve continued to consult with my friend on the job assignments problem that I have been discussing in post 1 and post 2. At first, he was excited about what we had come up with but I knew there were likely more complexities that had not been uncovered yet. He went back to the client and came away with some new information. He told me, &ldquo;Mathew, it turns out that machines have limited capacity."><meta name=application-name content="Mathew Crews"><meta name=apple-mobile-web-app-title content="Mathew Crews"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://matthewcrews.com/blog/2021/02/2021-02-04/><link rel=prev href=https://matthewcrews.com/blog/2021/01/2021-01-28/><link rel=next href=https://matthewcrews.com/blog/2021/05/2021-05-04/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Scheduling Jobs for Maximum Efficiency - Part 3","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/matthewcrews.com\/blog\/2021\/02\/2021-02-04\/"},"image":[{"@type":"ImageObject","url":"https:\/\/matthewcrews.com\/images\/Apple-Devices-Preview.png","width":3200,"height":2048}],"genre":"blog","wordcount":1607,"url":"https:\/\/matthewcrews.com\/blog\/2021\/02\/2021-02-04\/","datePublished":"2021-02-03T00:00:00+00:00","dateModified":"2023-05-08T10:51:36-07:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/matthewcrews.com\/images\/fast_fsharp_avatar.png"},"author":{"@type":"Person","name":"Matthew Crews"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Matthew Crews">Matthew Crews</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/blog/>Blog </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/matthewcrews/blog title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Matthew Crews">Matthew Crews</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/blog/ title>Blog</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/matthewcrews/blog title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster">Scheduling Jobs for Maximum Efficiency - Part 3</h1><div class=content id=content><p>I&rsquo;ve continued to consult with my friend on the job assignments problem that I have been discussing in <a href=/blog/2021/01/2021-01-25/ rel>post 1</a> and <a href=/blog/2021/01/2021-01-28/ rel>post 2</a>. At first, he was excited about what we had come up with but I knew there were likely more complexities that had not been uncovered yet. He went back to the client and came away with some new information. He told me, &ldquo;Mathew, it turns out that machines have limited capacity. We have to limit how much work is assigned to them.&rdquo;</p><p>&ldquo;Not a problem,&rdquo; I respond. I tell me friend that it is straightforward to add constraints to the model which limit how much work is assigned to a machine. Let me walk you through how I update the model we created in <a href=/blog/2021/01/2021-01-25/ rel>post 1</a> and <a href=/blog/2021/01/2021-01-28/ rel>post 2</a> to take this new limitation into consideration.</p><blockquote><p><strong>Note</strong>: The full code for this post can be found <a href=https://github.com/matthewcrews/modelmondays/blob/main/2021-01-22-MachineAllocation/2021-02-02-MachineAllocationWithCapacity.fsx target=_blank rel="noopener noreffer">here</a></p></blockquote><h2 id=machine-capacity-constraints>Machine Capacity Constraints</h2><p>The first thing we need to know is how much capacity machines have. My friend tells me that they are limited to 24.0 units of work. Our jobs are coming in sizes of 1, 2, or 3. Let&rsquo;s create a constraint for each machine which states that the total loading cannot exceed this amount.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// Limit on how much work a machine can be assigned
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>maxMachineCapacity</span> <span class=o>=</span> <span class=mi>24</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Machines have a limited capacity
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>maxMachineCapacityConstraints</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>ConstraintBuilder</span> <span class=s>&#34;MachineCapacity&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>machine</span> <span class=k>in</span> <span class=n>machines</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>sum</span> <span class=o>(</span><span class=n>assignments</span><span class=o>[</span><span class=n>machine</span><span class=o>,</span> <span class=n>All</span><span class=o>,</span> <span class=n>All</span><span class=o>]</span> <span class=o>.*</span> <span class=n>jobSizes</span><span class=o>)</span> <span class=o>&lt;==</span> <span class=n>maxMachineCapacity</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Remember, <code>machines</code> is the list of machines available for us to assign work to. We are looping through each machine and creating a constraint which says the sum of the work assigned to the machine cannot exceed the max capacity, <code>maxMachineCapacity</code>. <code>assignments</code> is a <code>SliceMap</code> indexed by machine, job-type, and job where the value is a Boolean decision. <code>1</code> indicates that we are assigning the job to the machine and <code>0</code> indicates that we are not. The notation <code>assignments.[machine, All, All]</code> is a &ldquo;slice&rdquo; which says, &ldquo;Give me the assignments for this <code>machine</code> across all job-types and jobs.&rdquo; <code>jobSizes</code> is another <code>SliceMap</code> where the key is a <code>job</code> and the value is the size of the job. We multiply the decisions by the size of the job using the <a href=https://en.wikipedia.org/wiki/Hadamard_product_%28matrices%29 target=_blank rel="noopener noreffer">Hadamard Product</a> <code>.*</code>.</p><p>Now that we have created some capacity constraints for the machines, let&rsquo;s add them to our model and try to solve.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// Compose the model
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>model</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nn>Model</span><span class=p>.</span><span class=n>addObjective</span> <span class=n>minSetupsObjective</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>maxWorkConstraints</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>minWorkConstraints</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraint</span> <span class=n>maxWorkDifferenceConstraint</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>setupConstraints</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>jobsAssignmentConstraints</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>maxJobTypeDConstraints</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>maxMachineCapacityConstraints</span> <span class=c1>// &lt;- New constraints
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Give the solver plenty of time to find a solution
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>settings</span> <span class=o>=</span> <span class=o>{</span> <span class=nn>Settings</span><span class=p>.</span><span class=n>basic</span> <span class=k>with</span> <span class=n>MaxDuration</span> <span class=o>=</span> <span class=mi>60_000L</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>result</span> <span class=o>=</span> <span class=nn>Solver</span><span class=p>.</span><span class=n>solve</span> <span class=n>settings</span> <span class=n>model</span>
</span></span></code></pre></td></tr></table></div></div><p>We&rsquo;ve cleaned up some of our code from earlier posts. All the solving is now abstracted behind the <code>Scheduler.schedule</code> function. It returns a new type if the solver can find a solution, <code>MachineAssignments</code>. This type contains a list machines and the jobs that are assigned to it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>type</span> <span class=nc>MachineAssignment</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Machine</span> <span class=o>:</span> <span class=n>Machine</span>
</span></span><span class=line><span class=cl>    <span class=n>Jobs</span> <span class=o>:</span> <span class=n>Job</span> <span class=kt>list</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>type</span> <span class=nc>MachineAssignments</span> <span class=o>=</span> <span class=n>MachineAssignments</span> <span class=k>of</span> <span class=n>MachineAssignment</span> <span class=kt>list</span>
</span></span></code></pre></td></tr></table></div></div><p>We now call <code>Scheduler.schedule</code> to see if we can find a plan which fits our requirements.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>scheduleResult</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl>    <span class=nn>Scheduler</span><span class=p>.</span><span class=n>schedule</span> <span class=n>maxWorkDifference</span> <span class=n>maxJobTypeDPercentage</span> <span class=n>maxMachineCapacity</span> <span class=n>jobs</span> <span class=n>machines</span>
</span></span></code></pre></td></tr></table></div></div><p>We would like to have the script print out some nice output. We created a function, <code>Printer.MachineAssignments.print</code>, which provides nice clean output if we are able to solve the problem. Let&rsquo;s call this function in the case that our solver successfully solved.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>match</span> <span class=n>scheduleResult</span> <span class=k>with</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nn>Result</span><span class=p>.</span><span class=n>Ok</span> <span class=n>assignments</span> <span class=o>-&gt;</span> <span class=nn>Printer</span><span class=p>.</span><span class=nn>MachineAssignments</span><span class=p>.</span><span class=n>print</span> <span class=n>assignments</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nn>Result</span><span class=p>.</span><span class=n>Error</span> <span class=n>msg</span> <span class=o>-&gt;</span> <span class=n>printfn</span> <span class=o>$</span><span class=s>&#34;{msg}&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>What do we get?</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; match scheduleResult with
</span></span><span class=line><span class=cl>- | Result.Ok assignments -&gt; Printer.MachineAssignments.print assignments
</span></span><span class=line><span class=cl>- | Result.Error msg -&gt; printfn $&#34;{msg}&#34;;;
</span></span><span class=line><span class=cl>Unable to solve
</span></span><span class=line><span class=cl>val it : unit = ()
</span></span></code></pre></td></tr></table></div></div><p>Uh oh, the solver failed to find a solution to our problem. What went wrong?</p><h2 id=when-the-solver-fails>When the Solver Fails</h2><p>The solver was not able to find a solution. It is reporting &ldquo;Unable to solve&rdquo;. How can this be? We were able to solve this problem before. What has changed? Let&rsquo;s think about it. We have added constraints which state that a machine cannot be overloaded. Overloaded in this case means anything over <code>24.0</code>. Previously we were loading the machines up to <code>28.0</code>, <code>29.0</code>, or <code>30.0</code>. We need to introduce a new concept to our vocabulary, &ldquo;Infeasible&rdquo;. <a href=https://en.wikipedia.org/wiki/Feasible_region target=_blank rel="noopener noreffer">Infeasible</a> is a term you will find frequently in the optimization literature. In this context what it means is that there is no solution to the problem. Our problem is overly constrained. What other constraints combined with our new machine capacity constraints could be causing this problem?</p><p>I&rsquo;ll give you a hint, it&rsquo;s the machine assignment constraints. Previously we defined a set of constraints, <code>jobsAssignmentConstraints</code>, which stated that every job must be assigned to a machine. In this new world though, that is not possible. There is simply too much work given the capacity of the machines. Therefore, the solver cannot find a solution. This is when we need to go back to the business and discuss priorities. What is truly the most important thing?</p><p>In this scenario, I was able to discuss the problem with my friend. We agreed that the first priority is to fully utilize the machines. After that, we want to minimize the number of different jobs that a machine processes. This is an example of <a href=https://en.wikipedia.org/wiki/Multi-objective_optimization target=_blank rel="noopener noreffer">multi-objective optimization</a>.</p><p>The idea is that there is a series of objective in order of importance. You iteratively solve for each objective. The mechanics of how this works will need to wait for another post. Fortunately, multi-objective models are simple to express with <code>Flips</code>. We add the objectives to the model in the order of their priority.</p><h2 id=mult-objective-formulation>Mult-Objective Formulation</h2><p>We need to create a new objective for maximizing the loading of machines. Let&rsquo;s do that by first creating an expression which evaluates the total machine loading.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// Maximize Utilization expression
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>maxUtilizationExpression</span> <span class=o>=</span> <span class=n>sum</span> <span class=o>(</span><span class=n>assignments</span> <span class=o>.*</span> <span class=n>jobSizes</span><span class=o>)</span> 
</span></span></code></pre></td></tr></table></div></div><p>The <code>maxUtilizationExpression</code> expression evaluates just how much we we have assigned to all machines. We can use this to create an objective.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>maxUtilizationObjective</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nn>Objective</span><span class=p>.</span><span class=n>create</span> <span class=s>&#34;MaxUtilization&#34;</span> <span class=n>Maximize</span> <span class=n>maxUtilizationExpression</span>
</span></span></code></pre></td></tr></table></div></div><p>This objective states that we would like to maximize the loading of the machines. We will use this new objective as the first objective of our model. We will also omit the <code>jobsAssignmentConstraints</code> that existed before since we no longer anticipate being able to assign all of the jobs to machines. Let&rsquo;s compose our new model.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// Compose the model
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>model</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nn>Model</span><span class=p>.</span><span class=n>create</span> <span class=n>maxUtilizationObjective</span> <span class=c1>// First priority objective
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addObjective</span> <span class=n>minSetupsObjective</span> <span class=c1>// Second priority objective
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>maxWorkConstraints</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>minWorkConstraints</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraint</span> <span class=n>maxWorkDifferenceConstraint</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>setupConstraints</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>maxJobTypeDConstraints</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraints</span> <span class=n>maxMachineCapacityConstraints</span>
</span></span></code></pre></td></tr></table></div></div><p>Note that we create the initial model using the <code>maxUtilizationObjective</code> objective then add the <code>minSetupsObjective</code> to the model. This means that the solver will find a solution which maximizes the machine utilization first and then search for a solution that minimizes the number of different job-types. Let&rsquo;s try to solve this and see what we get. This code comes from the <code>Scheduler.schedule</code> function. If the solver is successful, it returns a <code>Result.Ok</code> with the machine assignments. If it fails to find a solution, it returns a <code>Result.Error</code> with &ldquo;Unable to solve&rdquo; as the message.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// Give the solver plenty of time to find a solution
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>let</span> <span class=nv>settings</span> <span class=o>=</span> <span class=o>{</span> <span class=nn>Settings</span><span class=p>.</span><span class=n>basic</span> <span class=k>with</span> <span class=n>MaxDuration</span> <span class=o>=</span> <span class=mi>60_000L</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>result</span> <span class=o>=</span> <span class=nn>Solver</span><span class=p>.</span><span class=n>solve</span> <span class=n>settings</span> <span class=n>model</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>match</span> <span class=n>result</span> <span class=k>with</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=n>Optimal</span> <span class=n>solution</span> <span class=o>-&gt;</span> 
</span></span><span class=line><span class=cl>    <span class=n>getMachineAssignments</span> <span class=n>solution</span> <span class=n>assignments</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=n>MachineAssignments</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>Result</span><span class=p>.</span><span class=n>Ok</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=o>_</span> <span class=o>-&gt;</span> <span class=nn>Result</span><span class=p>.</span><span class=n>Error</span> <span class=s>&#34;Unable to solve&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>If we use our pretty printer function, we get the following.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>scheduleResult</span> <span class=o>=</span> 
</span></span><span class=line><span class=cl>    <span class=nn>Scheduler</span><span class=p>.</span><span class=n>schedule</span> <span class=n>maxWorkDifference</span> <span class=n>maxJobTypeDPercentage</span> <span class=n>maxMachineCapacity</span> <span class=n>jobs</span> <span class=n>machines</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>match</span> <span class=n>scheduleResult</span> <span class=k>with</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nn>Result</span><span class=p>.</span><span class=n>Ok</span> <span class=n>assignments</span> <span class=o>-&gt;</span> <span class=nn>Printer</span><span class=p>.</span><span class=nn>MachineAssignments</span><span class=p>.</span><span class=n>print</span> <span class=n>assignments</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nn>Result</span><span class=p>.</span><span class=n>Error</span> <span class=n>msg</span> <span class=o>-&gt;</span> <span class=n>printfn</span> <span class=o>$</span><span class=s>&#34;{msg}&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>I use the <a href=https://github.com/spectresystems/spectre.console target=_blank rel="noopener noreffer">Specture.Console</a> library for printing these tables to the console.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Machine Loading:
</span></span><span class=line><span class=cl>┌─────────┬────────────┬─────────────────────┬────────────────────┐
</span></span><span class=line><span class=cl>│ Machine │ Total Work │ Percent Type D Work │ Distinct Job Count │
</span></span><span class=line><span class=cl>├─────────┼────────────┼─────────────────────┼────────────────────┤
</span></span><span class=line><span class=cl>│ 1       │ 24         │ 0.00%               │ 1                  │
</span></span><span class=line><span class=cl>│ 2       │ 24         │ 0.00%               │ 1                  │
</span></span><span class=line><span class=cl>│ 3       │ 24         │ 0.00%               │ 1                  │
</span></span><span class=line><span class=cl>│ 4       │ 24         │ 0.00%               │ 1                  │
</span></span><span class=line><span class=cl>│ 5       │ 24         │ 0.00%               │ 1                  │
</span></span><span class=line><span class=cl>└─────────┴────────────┴─────────────────────┴────────────────────┘
</span></span></code></pre></td></tr></table></div></div><p>We see that the solver is filling up each machine with the maximum capacity available. Each machine is also only processing a single job-type. None of job-type D is being processed on any of these machines, interesting. Is that what we want? Maybe we want a policy which prioritizes some of the jobs above others? Maybe when work carries over from the previous day, it needs to be prioritized over new work coming in?</p><p>These are some interesting questions that we will explore in the next post! I hope you are enjoying this series and it is giving you insight into how Mathematical Planning can be used to deal with many different scheduling challenges. More posts to come!</p><p>Please send me an email at <a href=mailto:matthewcrews@gmail.com rel>matthewcrews@gmail.com</a> if you have any questions and subscribe so you can stay on top new posts and products I am offering.</p><script>window.mootrack||!function(e,t,n,s,o){function i(e){var s,o=~~(Date.now()/3e5),t=document.createElement(n);t.async=!0,t.src=e+"?ts="+o,s=document.getElementsByTagName(n)[0],s.parentNode.insertBefore(t,s)}e.MooTrackerObject=o,e[o]=e[o]||function(){return e[o].q?void e[o].q.push(arguments):void(e[o].q=[arguments])},window.attachEvent?window.attachEvent("onload",i.bind(this,s)):window.addEventListener("load",i.bind(this,s),!1)}(window,document,"script","https://cdn.stat-track.com/statics/moosend-tracking.min.js","mootrack"),mootrack("loadForm","b498d29aaba84b5bb3e0479003dc7264")</script><div data-mooform-id=b498d29a-aba8-4b5b-b3e0-479003dc7264></div></div><div id=comments></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=matthewcrews.com target=_blank>Matthew Crews</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"PASDMWALPK",algoliaIndex:"index.en",algoliaSearchKey:"b42948e51daaa93df92381c8e2ac0f93",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>