<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Maximizing Profitability of Inventory with Mathematical Planning and Machine Learning in F# - Part 2 - Matthew Crews</title><meta name=Description content="Hugo theme - LoveIt"><meta property="og:title" content="Maximizing Profitability of Inventory with Mathematical Planning and Machine Learning in F# - Part 2"><meta property="og:description" content="In a previous post we discussed the problem of stocking our food cart to maximize our profitability. We created a simple heuristic and then performed simulations to evaluate the expected profitability. We discussed that knowing the expected profitability was not enough, we calculated Confidence Intervals to understand the where the true expected profitability lies. This week we want to find a better plan for packing the food cart. We will use Mathematical Planning to find an answer which maximize the expected profitability which outperforms the heuristic used in the first post."><meta property="og:type" content="article"><meta property="og:url" content="https://matthewcrews.com/blog/2020/12/2020-12-21/"><meta property="og:image" content="https://matthewcrews.com/logo.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-12-21T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-30T21:57:33-08:00"><meta property="og:site_name" content="Matthew Crews"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://matthewcrews.com/logo.png"><meta name=twitter:title content="Maximizing Profitability of Inventory with Mathematical Planning and Machine Learning in F# - Part 2"><meta name=twitter:description content="In a previous post we discussed the problem of stocking our food cart to maximize our profitability. We created a simple heuristic and then performed simulations to evaluate the expected profitability. We discussed that knowing the expected profitability was not enough, we calculated Confidence Intervals to understand the where the true expected profitability lies. This week we want to find a better plan for packing the food cart. We will use Mathematical Planning to find an answer which maximize the expected profitability which outperforms the heuristic used in the first post."><meta name=application-name content="Mathew Crews"><meta name=apple-mobile-web-app-title content="Mathew Crews"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://matthewcrews.com/blog/2020/12/2020-12-21/><link rel=prev href=https://matthewcrews.com/blog/2020/12/2020-12-14/><link rel=next href=https://matthewcrews.com/blog/2021/01/2020-01-01/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Maximizing Profitability of Inventory with Mathematical Planning and Machine Learning in F# - Part 2","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/matthewcrews.com\/blog\/2020\/12\/2020-12-21\/"},"image":[{"@type":"ImageObject","url":"https:\/\/matthewcrews.com\/images\/Apple-Devices-Preview.png","width":3200,"height":2048}],"genre":"blog","wordcount":1856,"url":"https:\/\/matthewcrews.com\/blog\/2020\/12\/2020-12-21\/","datePublished":"2020-12-21T00:00:00+00:00","dateModified":"2022-11-30T21:57:33-08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/matthewcrews.com\/images\/fast_fsharp_avatar.png"},"author":{"@type":"Person","name":"Matthew Crews"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Matthew Crews">Matthew Crews</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/blog/>Blog </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/matthewcrews/blog title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Matthew Crews">Matthew Crews</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/blog/ title>Blog</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/matthewcrews/blog title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster">Maximizing Profitability of Inventory with Mathematical Planning and Machine Learning in F# - Part 2</h1><div class=content id=content><p>In a <a href=/blog/2020/12/2020-12-14/ rel>previous post</a> we discussed the problem of stocking our food cart to maximize our profitability. We created a simple heuristic and then performed simulations to evaluate the expected profitability. We discussed that knowing the expected profitability was not enough, we calculated Confidence Intervals to understand the where the true expected profitability lies. This week we want to find a better plan for packing the food cart. We will use Mathematical Planning to find an answer which maximize the expected profitability which outperforms the heuristic used in the first post.</p><blockquote><p><strong>Note:</strong> To see all the code for this post, go <a href=https://github.com/matthewcrews/modelmondays/blob/main/ModelMonday/2020-12-14-FoodCartSeries/2020-12-17-Part2.fs target=_blank rel="noopener noreffer">here</a></p></blockquote><h2 id=the-probability-of-selling>The Probability of Selling</h2><blockquote><p><strong>Math Warning:</strong> I like to explain the math behind how we calculate the probablility of us selling items. If you would like to skip the math, feel free to jump to the next <a href=/blog/2020/12/2020-12-21/#applying-to-food-cart-problem rel>section</a></p></blockquote><p>There&rsquo;s a nuance to this problem that the heuristic from the previous post did not take into consideration. We know that the number of sales of a food can be modeled by a <a href=https://en.wikipedia.org/wiki/Poisson_distribution target=_blank rel="noopener noreffer">Poisson Distribution</a>. The Poisson Distribution takes a single parameter, $\lambda$, which is the average arrival rate of a process. In our case, the &ldquo;process&rdquo; is people placing orders for a given food. Our historical data shows that the average daily demand for food is 600 burgers, 900 pizzas, and 700 tacos.</p><table><thead><tr><th></th><th>Burger</th><th>Pizza</th><th>Taco</th></tr></thead><tbody><tr><td>Average Demand</td><td>$600.0 \frac{\text{item}}{\text{day}}$</td><td>$900.0 \frac{\text{item}}{\text{day}}$</td><td>$700.0 \frac{\text{item}}{\text{day}}$</td></tr></tbody></table><p>Why do we care about this? Why do we care that the demand is actually a Poisson Distribution? Let&rsquo;s perform a thought experiment. What are the odds that we sell at least 1 pizza in a day? Essentially 100%, right? What about 2 pizzas? Still 100% but maybe infinitesimally smaller. What are the odds of us selling 900 pizzas? Well, ~50% because historically we have seen that is the average demand. On rare days we will only sell 800 pizzas and on some we may sell over 1,000 if we do not run out of inventory. We can use the Poisson Distribution to calculate the odds of us selling a particular number of pizzas on any given day. Before we go any farther, lets plot the distribution of pizza demand between 800 and 1,000.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/img/2020-12-21-demand-distribution.png data-srcset="/img/2020-12-21-demand-distribution.png, /img/2020-12-21-demand-distribution.png 1.5x, /img/2020-12-21-demand-distribution.png 2x" data-sizes=auto alt=/img/2020-12-21-demand-distribution.png title="Pizza Demand Distribution"></p><p>You notice that the peak is at 900 which is what we expect since that is the average. Visually we can tell that the probability of demand being between 850 and 950 is high but drops off rapidly at the tails.</p><p>We need to figure out how to use this information to help us find the ideal number of each food we should pack. What would be really useful is being able to calculate what the probability is of us completely selling our inventory. If we pack 950 pizzas, how likely are we to sell through all of them? We would rather not waste space on foods that are not going to sell. We need a function which allows us to calculate the probability of demand exceeding some value of $x$. In math terms we would write:</p><p>$$
P(demand > x)
$$</p><p>One the ingredients for this calculation is called the Cumulative Distribution Function (CDF). The CDF for the Poisson Distribution is:</p><p>$$
\text{CDF}(x) = P(X \le x) = \frac{\Gamma(x + 1,\ \lambda)}{\lfloor x \rfloor !} \qquad \qquad x = 0,1,2 , \ldots
$$</p><p>That&rsquo;s some scary looking math so let&rsquo;s unpack what this means. The function $F(x)$ calculates the probability of a random observation from our Poisson Distribution being less than or equal to the value of $x$. In our case, $x$ is the number of servings we pack of a food.</p><p>The CDF isn&rsquo;t quite what we need. What we want is to know the probability of demand <strong>exceeding</strong> $x$, not being less or equal to $x$. It is pretty simple to adjust the formula though. The probability of demand being greater than $x$ is equal to 1.0 minus the probability of demand being less than $x$</p><p>$$
P(demand > x) = 1 - P(demand \leq x)
$$</p><p>We can swap in our CDF for the Poisson distribution to get a new formula which allows us to calculate the demand exceeding $x$.</p><p>$$
P(demand > x) = 1 - \frac{\Gamma(x + 1,\ \lambda)}{\lfloor x \rfloor !}
$$</p><p>Fortunately, the <code>MathNET</code> library includes a function for calculating these values so we will not need to worry about implementing them.</p><h2 id=applying-to-food-cart-problem>Applying to Food Cart Problem</h2><p>How do we apply this to the food cart problem? Let&rsquo;s say we want to know the odds of us being able to sell at least 800 pizzas. We can plug the value into the function, and we get a probability of 99.963% chance of demand exceeding 800. We can also put 1,000 in and find that there is only a 0.049% chance of demand for pizza being that high.</p><p>We will use this in our objective function. We want to maximize the expected revenue so we will weight the revenue we receive for an item by the probability that we actually sell it. This means that the revenue we receive for the $n^\text{th}$ item of a given food will be multiplied by the probability that demand meets are exceeds that amount. This gives us the following formula for expected revenue.</p><p>$$
\text{Expected Revenue} = \sum_{f \in food}\sum_{n} P(\text{demand} \ge n) * \text{Revenue}_{f}
$$</p><p>We are using the same domain as in the previous post and we will be extending it. Let&rsquo;s write a function which will gives us the probabilities of selling the $n^\text{th}$ number of a food. To keep track of the $n^\text{th}$ item we are going to add a new type to our domain.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>type</span> <span class=nc>NthItem</span> <span class=o>=</span> <span class=n>NthItem</span> <span class=k>of</span> <span class=n>int</span>
</span></span></code></pre></td></tr></table></div></div><p>Now we create the function which calculates the probabilites for a given food for 1 item up to some max number of items.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>createIncrementProbability</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>foodDemands</span><span class=o>:</span> <span class=n>seq</span><span class=o>&lt;</span><span class=n>Food</span> <span class=o>*</span> <span class=n>DemandRate</span><span class=o>&gt;)</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>maxItems</span><span class=o>:</span> <span class=n>int</span><span class=o>)</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>seq</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>food</span><span class=o>,</span> <span class=n>DemandRate</span> <span class=n>demandRate</span><span class=o>)</span> <span class=k>in</span> <span class=n>foodDemands</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=k>in</span> <span class=mi>1</span><span class=o>..</span><span class=n>maxItems</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>                <span class=k>let</span> <span class=nv>probability</span> <span class=o>=</span>  <span class=mi>1</span><span class=o>.</span><span class=mi>0</span> <span class=o>-</span> <span class=o>(</span><span class=nn>Poisson</span><span class=p>.</span><span class=n>CDF</span> <span class=o>(</span><span class=n>demandRate</span> <span class=o>-</span> <span class=mi>1</span><span class=o>.</span><span class=mi>0</span><span class=o>,</span> <span class=o>(</span><span class=kt>float</span> <span class=n>i</span><span class=o>)))</span>
</span></span><span class=line><span class=cl>                <span class=o>(</span><span class=n>food</span><span class=o>,</span> <span class=n>NthItem</span> <span class=n>i</span><span class=o>),</span> <span class=n>probability</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=o>|&gt;</span> <span class=n>SMap2</span>
</span></span></code></pre></td></tr></table></div></div><p>The <code>createIncrementProbability</code> function takes in a sequence of <code>Food * DemandRate</code> tuples for which we will generate probabilities. <code>Food</code> is a type we are using to represent burger, pizza, or taco. The <code>DemandRate</code> type represents the average daily demand for a food.</p><p>For each food, we calculate the probability of demand meeting or exceeding the values from 1 to <code>maxItems</code>. <code>maxItems</code> is the maximum quantity of a given food we would consider packing into our food cart. We store this data in a <code>SMap2</code> for ease use in our model formulation.</p><p>We now create a function for building a model for our problem. Let&rsquo;s call it <code>create</code> and have it take all the arguments we will need for our model.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>create</span> 
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>revenue</span><span class=o>:</span> <span class=n>SMap</span><span class=o>&lt;</span><span class=n>Food</span><span class=o>,</span> <span class=kt>float</span><span class=o>&lt;</span><span class=n>USD</span><span class=o>/</span><span class=n>serving</span><span class=o>&gt;&gt;)</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>storage</span><span class=o>:</span> <span class=n>SMap</span><span class=o>&lt;</span><span class=n>Food</span><span class=o>,</span> <span class=kt>float</span><span class=o>&lt;</span><span class=n>cm</span><span class=o>^</span><span class=mi>3</span><span class=o>/</span><span class=n>serving</span><span class=o>&gt;&gt;)</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>fridgeSpace</span><span class=o>:</span> <span class=n>SMap</span><span class=o>&lt;</span><span class=n>Food</span><span class=o>,</span> <span class=kt>float</span><span class=o>&lt;</span><span class=n>cm</span><span class=o>^</span><span class=mi>3</span><span class=o>/</span><span class=n>serving</span><span class=o>&gt;&gt;)</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>weight</span><span class=o>:</span> <span class=n>SMap</span><span class=o>&lt;</span><span class=n>Food</span><span class=o>,</span> <span class=kt>float</span><span class=o>&lt;</span><span class=n>gm</span><span class=o>/</span><span class=n>serving</span><span class=o>&gt;&gt;)</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>incrementProbability</span><span class=o>:</span> <span class=n>SMap2</span><span class=o>&lt;</span><span class=n>Food</span><span class=o>,</span> <span class=n>NthItem</span><span class=o>,</span> <span class=kt>float</span><span class=o>&gt;)</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>packDecision</span><span class=o>:</span> <span class=n>SMap2</span><span class=o>&lt;</span><span class=n>Food</span><span class=o>,</span> <span class=n>NthItem</span><span class=o>,</span> <span class=n>Decision</span><span class=o>&lt;</span><span class=n>serving</span><span class=o>&gt;&gt;)</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>maxStorage</span><span class=o>:</span> <span class=kt>float</span><span class=o>&lt;</span><span class=n>cm</span><span class=o>^</span><span class=mi>3</span><span class=o>&gt;)</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>maxWeight</span><span class=o>:</span> <span class=kt>float</span><span class=o>&lt;</span><span class=n>gm</span><span class=o>&gt;)</span>
</span></span><span class=line><span class=cl>    <span class=o>(</span><span class=n>maxFridgeSpace</span><span class=o>:</span> <span class=kt>float</span><span class=o>&lt;</span><span class=n>cm</span><span class=o>^</span><span class=mi>3</span><span class=o>&gt;)</span> <span class=o>=</span>
</span></span></code></pre></td></tr></table></div></div><p>Parameter Definitions:</p><ul><li><code>revenue</code> is the amount of money we make when selling a particular <code>Food</code></li><li><code>storage</code> is the amount of pantry space required to pack a single serving</li><li><code>fridgeSpace</code> is the amount of fridge space required to for a single serving</li><li><code>weight</code> is the weight for a single serving of a food</li><li><code>incrementProbability</code> is the probability of selling a particular quantity of a <code>Food</code></li><li><code>packDecision</code> is a 2-dimensional SliceMap indexed by <code>Food</code> and <code>NthItem</code>. <code>Food</code> will correspond to burger, pizza, or taco. <code>NthItem</code> is the index of particular food within the group. The $1^\text{st}$ pizza, the $2^\text{nd}$ pizza, the $3^\text{rd}$ pizza etc. The value stored in the SliceMap is a <code>Boolean</code> decision variable where 1 indicates that you should pack the food and 0 indicates that you should not.</li><li><code>maxStorage</code> is the maximum amount of storage space</li><li><code>maxweight</code> is the maxumum amount of weight that can be packed</li><li><code>maxFridgeSpace</code> is the maximum amount of refrigerated storage</li></ul><p>From here creating our model is straightforward. We need to create a constraints for the available storage, weight, and fridge space. We take advantage of the <code>sum</code> function and <a href=https://en.wikipedia.org/wiki/Hadamard_product_%28matrices%29 target=_blank rel="noopener noreffer">Hadamard Product</a> operator, <code>.*</code>, included in the <code>SliceMap</code> library to make the notation simple. The Hadamard Product is taking care of the joining of the data before multiplying the values.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>weightConstraint</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nn>Constraint</span><span class=p>.</span><span class=n>create</span> <span class=s>&#34;MaxWeight&#34;</span> <span class=o>(</span><span class=n>sum</span> <span class=o>(</span><span class=n>weight</span> <span class=o>.*</span> <span class=n>packDecision</span><span class=o>)</span> <span class=o>&lt;==</span> <span class=n>maxWeight</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>storageConstraint</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nn>Constraint</span><span class=p>.</span><span class=n>create</span> <span class=s>&#34;MaxStorage&#34;</span> <span class=o>(</span><span class=n>sum</span> <span class=o>(</span><span class=n>storage</span> <span class=o>.*</span> <span class=n>packDecision</span><span class=o>)</span> <span class=o>&lt;==</span> <span class=n>maxStorage</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>fridgeSpaceConstraint</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nn>Constraint</span><span class=p>.</span><span class=n>create</span> <span class=s>&#34;MaxFridgeSpace&#34;</span> <span class=o>(</span><span class=n>sum</span> <span class=o>(</span><span class=n>fridgeSpace</span> <span class=o>.*</span> <span class=n>packDecision</span><span class=o>)</span> <span class=o>&lt;==</span> <span class=n>maxFridgeSpace</span><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Our objective function is the revenue adjusted for the probability of selling the number of items. We then use this expression to create an objective.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>revenueExpectation</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>sum</span> <span class=o>(</span><span class=n>revenue</span> <span class=o>.*</span> <span class=n>incrementProbability</span> <span class=o>.*</span> <span class=n>packDecision</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>objective</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nn>Objective</span><span class=p>.</span><span class=n>create</span> <span class=s>&#34;MaxRevenueExpectation&#34;</span> <span class=n>Maximize</span> <span class=n>revenueExpectation</span>
</span></span></code></pre></td></tr></table></div></div><p>We bring all this together and create a model which is what the <code>create</code> function returns.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=nn>Model</span><span class=p>.</span><span class=n>create</span> <span class=n>objective</span>
</span></span><span class=line><span class=cl><span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraint</span> <span class=n>weightConstraint</span>
</span></span><span class=line><span class=cl><span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraint</span> <span class=n>storageConstraint</span>
</span></span><span class=line><span class=cl><span class=o>|&gt;</span> <span class=nn>Model</span><span class=p>.</span><span class=n>addConstraint</span> <span class=n>fridgeSpaceConstraint</span>
</span></span></code></pre></td></tr></table></div></div><p>Now we can calculate our probabilities, create decision variables, and use these functions to build the model and solve it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>incrementProbabilities</span> <span class=o>=</span> <span class=nn>PlanningModel</span><span class=p>.</span><span class=n>createIncrementProbability</span> <span class=n>demandRates</span> <span class=n>maxItems</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>packDecisions</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>DecisionBuilder</span><span class=o>&lt;</span><span class=n>serving</span><span class=o>&gt;</span> <span class=s>&#34;Pack&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>food</span> <span class=k>in</span> <span class=n>foods</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>increment</span> <span class=k>in</span> <span class=o>([</span><span class=mi>1</span> <span class=o>..</span> <span class=n>maxItems</span><span class=o>]</span> <span class=o>|&gt;</span> <span class=nn>List</span><span class=p>.</span><span class=n>map</span> <span class=n>DemandLevel</span><span class=o>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>Boolean</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=o>|&gt;</span> <span class=n>SMap2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>planModel</span> <span class=o>=</span> <span class=nn>PlanningModel</span><span class=p>.</span><span class=n>create</span> <span class=n>revenue</span> <span class=n>storage</span> <span class=n>fridgeSpace</span> <span class=n>weight</span> <span class=n>incrementProbabilities</span> <span class=n>packDecisions</span> <span class=n>maxStorage</span> <span class=n>maxWeight</span> <span class=n>maxFridge</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>let</span> <span class=nv>result</span> <span class=o>=</span> <span class=nn>Solver</span><span class=p>.</span><span class=n>solve</span> <span class=nn>Settings</span><span class=p>.</span><span class=n>basic</span> <span class=n>planModel</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s compare the plan from the Heuristic in the last post to what the Optimization is recommending.</p><table><thead><tr><th></th><th>Burgers</th><th>Pizza</th><th>Taco</th><th>Storage Usage</th><th>Fridge Usage</th><th>Weight Usage</th></tr></thead><tbody><tr><td>Heuristic</td><td>0</td><td>900</td><td>466</td><td>40.93%</td><td>62.10%</td><td>99.96%</td></tr><tr><td>Optimization</td><td>572</td><td>355</td><td>669</td><td>42.43%</td><td>70.86%</td><td>100.00%</td></tr></tbody></table><p>This is quite a different plan than what we saw before. The real test will come from performing the simulations with both plans and seeing which one ends up with a better expected revenue and tighter standard deviation. We perform 1M simulations of both plans and see the following.</p><table><thead><tr><th>Metric</th><th>Heuristic</th><th>Optimization</th></tr></thead><tbody><tr><td>Revenue Mean ± (99% CI)</td><td>2073.25 ± 0.07</td><td>2244.10 ± 0.03</td></tr><tr><td>Revenue Variance</td><td>776.27</td><td>110.34</td></tr><tr><td>Revenue StdDev</td><td>27.86</td><td>10.50</td></tr></tbody></table><p>The plan found by the optimization is providing an additional $171 in revenue but also has a lower Standard Deviation which means the revenue is more reliable. This is a fantastic result and shows how taking the randomness into account can yield superior results.</p><h2 id=next-steps>Next Steps</h2><p>This post showed that even a simple mathematical planning model can yield significant improvements over simple heuristics for decision making. By taking the variability of demand into account we were able to realize a higher average revenue but also a more reliable amount of revenue.</p><p>In the next post we will introduce a simple Machine Learning model to make predictions about demand in the future. So far, we have only used the historical average of demand to create our plan. What if we took that data and instead created a model for predicting demand and then fed that into our Mathematical Planning model?</p></div><div id=comments></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.107.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=matthewcrews.com target=_blank>Matthew Crews</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"PASDMWALPK",algoliaIndex:"index.en",algoliaSearchKey:"b42948e51daaa93df92381c8e2ac0f93",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>