<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Creating Summable Domain Types - Matthew Crews</title><meta name=Description content="Hugo theme - LoveIt"><meta property="og:title" content="Creating Summable Domain Types"><meta property="og:description" content="One of the reasons that I love F# is that is makes it incredibly easy to model domains. By creating a Domain Model which represents the business domain it becomes relatively easy to create workflows and algorithms which streamline business processes. In this post I show how to create types for a domain which are summable, a feature I use frequently in my work.
The Value of Restricting Values When I have to create a new Domain Model one of the first things that I do is define a single case Discriminated Union of decimal for the basic building blocks that I am going to work with (Costs, Items, Sales Rates, Days of Inventory, etc."><meta property="og:type" content="article"><meta property="og:url" content="https://matthewcrews.com/blog/2018/2018-05-13-creating-summable-domain-types/"><meta property="og:image" content="https://matthewcrews.com/logo.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2018-05-13T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-30T21:57:33-08:00"><meta property="og:site_name" content="Matthew Crews"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://matthewcrews.com/logo.png"><meta name=twitter:title content="Creating Summable Domain Types"><meta name=twitter:description content="One of the reasons that I love F# is that is makes it incredibly easy to model domains. By creating a Domain Model which represents the business domain it becomes relatively easy to create workflows and algorithms which streamline business processes. In this post I show how to create types for a domain which are summable, a feature I use frequently in my work.
The Value of Restricting Values When I have to create a new Domain Model one of the first things that I do is define a single case Discriminated Union of decimal for the basic building blocks that I am going to work with (Costs, Items, Sales Rates, Days of Inventory, etc."><meta name=application-name content="Mathew Crews"><meta name=apple-mobile-web-app-title content="Mathew Crews"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://matthewcrews.com/blog/2018/2018-05-13-creating-summable-domain-types/><link rel=prev href=https://matthewcrews.com/blog/2018/2018-05-04-fsharp-for-optimization-modeling/><link rel=next href=https://matthewcrews.com/blog/2018/2018-05-22-discrete-optimization-with-branch-and-bound/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Creating Summable Domain Types","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/matthewcrews.com\/blog\/2018\/2018-05-13-creating-summable-domain-types\/"},"image":[{"@type":"ImageObject","url":"https:\/\/matthewcrews.com\/images\/Apple-Devices-Preview.png","width":3200,"height":2048}],"genre":"blog","wordcount":996,"url":"https:\/\/matthewcrews.com\/blog\/2018\/2018-05-13-creating-summable-domain-types\/","datePublished":"2018-05-13T00:00:00+00:00","dateModified":"2022-11-30T21:57:33-08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/matthewcrews.com\/images\/fast_fsharp_avatar.png"},"author":{"@type":"Person","name":"Matthew Crews"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Matthew Crews">Matthew Crews</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/blog/>Blog </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/matthewcrews/blog title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Matthew Crews">Matthew Crews</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/blog/ title>Blog</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/matthewcrews/blog title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster">Creating Summable Domain Types</h1><div class=content id=content><p>One of the reasons that I love F# is that is makes it incredibly easy to model domains. By creating a Domain Model which represents the business domain it becomes relatively easy to create workflows and algorithms which streamline business processes. In this post I show how to create types for a domain which are summable, a feature I use frequently in my work.</p><h2 id=the-value-of-restricting-values>The Value of Restricting Values</h2><p>When I have to create a new Domain Model one of the first things that I do is define a single case Discriminated Union of <code>decimal</code> for the basic building blocks that I am going to work with (Costs, Items, Sales Rates, Days of Inventory, etc.). For example, when I am creating an algorithm to evaluate the financial viability of a product on marketplaces I have to calculate costs, I therefore create a <code>Cost</code> type. In my domain, a <code>Cost</code> is never negative therefore I can create a constructor which will enforce this behavior.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>type</span> <span class=nc>Cost</span> <span class=o>=</span> <span class=n>Cost</span> <span class=k>of</span> <span class=kt>decimal</span> <span class=c1>// Define a single case DU &#39;Cost&#39; for decimal
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>module</span> <span class=nn>Cost</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=k>let</span> <span class=nv>create</span> <span class=n>c</span> <span class=o>=</span>         <span class=c1>// Function for creating &#39;Cost&#39; values
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=mi>0M</span> <span class=k>then</span>    <span class=c1>// Check that the value is greater than 0.0M
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>None</span>           <span class=c1>// Return None if outside bounds
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=n>Some</span><span class=o>(</span><span class=n>Cost</span> <span class=n>c</span><span class=o>)</span>   <span class=c1>// Return input wrapped in a &#39;Cost&#39; value
</span></span></span></code></pre></td></tr></table></div></div><p>The beautiful thing about this is that when I am working with a <code>Cost</code> type I never have to worry about it being negative. This is a powerful thing when it comes to composing algorithms because I have eliminated a whole host of possible values that I would need to handle. It is amazing how easy it is for a negative numbers to sneak in and cause havoc. I force myself to deal with this bad data at the boundary of the domain instead of inside the algorithm performing the analysis.</p><h2 id=the-downside-where-did-addition-go>The Downside: Where Did Addition Go?</h2><p>There is a downside to doing this though, basic math operations will not work. At this point if I try to add two different <code>Cost</code> values I will get a compiler error.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>totalCost</span> <span class=o>=</span> <span class=n>cost1</span> <span class=o>+</span> <span class=n>cost2</span> <span class=c1>// Error: The type &#39;Cost&#39; does not support the &#39;+&#39; operator
</span></span></span></code></pre></td></tr></table></div></div><p>Fortunately this is easy to overcome. All we need to do is implement the <code>+</code> operator for the type. We do this by adding a <code>static member</code> to our type alias. We add the keyword <code>with</code> to the end of our previous type alias definition and provide the <code>+</code> static member.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// Updated definition of &#39;Cost&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>type</span> <span class=nc>Cost</span> <span class=o>=</span> <span class=n>Cost</span> <span class=k>of</span> <span class=kt>decimal</span> <span class=k>with</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>member</span> <span class=o>(+)</span> <span class=o>(</span><span class=n>Cost</span> <span class=n>c1</span><span class=o>,</span> <span class=n>Cost</span> <span class=n>c2</span><span class=o>)</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=n>Cost</span> <span class=o>(</span><span class=n>c1</span> <span class=o>+</span> <span class=n>c2</span><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>The arguments for the <code>+</code> function may look a little odd so let me explain. By declaring the arguments of the function as <code>(Cost c1, Cost c2)</code> I am telling the compiler that I expect a <code>Cost</code> type as the input and I want you to unpack the value inside of <code>Cost</code> and put it in the <code>c1</code> and <code>c2</code> values respectively. This allows me to work with the <code>decimal</code> values inside of the <code>Cost</code> type. The function itself adds the two values together and then wraps the result in a <code>Cost</code>. Now when we go to add two <code>Cost</code> values we no longer get an error.</p><p>The beauty of this is that I have maintained control over the values that <code>Cost</code> can take on. I declared a <code>create</code> function which insures positive values. I only allow addition of <code>Cost</code> types which means that a <code>Cost</code> will only ever be positive. Some people may brush this off as trivial but as someone who has seen the damage that can happen from values going outside of the expected range, this extra work for reliability and peace of mind is worth it. For me, it is more efficient to ensure values cannot go outside their allowed bounds through controlling construction and operator definitions than to have value checks all over the place.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>totalCost</span> <span class=o>=</span> <span class=n>cost1</span> <span class=o>+</span> <span class=n>cost2</span>
</span></span><span class=line><span class=cl><span class=c1>// Result: val totalCost : Cost = Cost 15.0M
</span></span></span></code></pre></td></tr></table></div></div><h2 id=enabling-summation>Enabling Summation</h2><p>Well, that is great and all but what happens when we have a <code>List</code> of <code>Cost</code> values and we want to sum them. What happens then?</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>sumCosts</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=o>[</span><span class=n>cost1</span><span class=o>;</span> <span class=n>cost2</span><span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>List</span><span class=p>.</span><span class=n>sum</span> <span class=c1>// Error: The type &#39;Cost&#39; does not support the operator &#39;get_Zero&#39;
</span></span></span></code></pre></td></tr></table></div></div><p>Now when I first came across this I was confused. I had no idea what this <code>get_Zero</code> operator meant. After digging around for a while I was able to find some examples of what it was referring to. The <code>sum</code> function wants a starting point for the summation and it gets that by calling the <code>Zero</code> function on the type. I don&rsquo;t know why the compiler is saying <code>does not support the operator 'get_Zero'</code> instead of saying <code>the type does not have a function named 'Zero'</code>. Again, F# makes this easy to implement.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=c1>// Summable &#39;Cost&#39; type
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>type</span> <span class=nc>Cost</span> <span class=o>=</span> <span class=n>Cost</span> <span class=k>of</span> <span class=kt>decimal</span> <span class=k>with</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>member</span> <span class=o>(+)</span> <span class=o>(</span><span class=n>Cost</span> <span class=n>c1</span><span class=o>,</span> <span class=n>Cost</span> <span class=n>c2</span><span class=o>)</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=n>Cost</span> <span class=o>(</span><span class=n>c1</span> <span class=o>+</span> <span class=n>c2</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>member</span> <span class=n>Zero</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=n>Cost</span> <span class=mi>0</span><span class=o>.</span><span class=mi>0M</span>
</span></span></code></pre></td></tr></table></div></div><p>Now when we try to sum a list of <code>Cost</code> values we get the expected result.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fsharp data-lang=fsharp><span class=line><span class=cl><span class=k>let</span> <span class=nv>sumCosts</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=o>[</span><span class=n>cost1</span><span class=o>;</span> <span class=n>cost2</span><span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>|&gt;</span> <span class=nn>List</span><span class=p>.</span><span class=n>sum</span>
</span></span><span class=line><span class=cl><span class=c1>// Result: val sumCosts : Cost = Cost 15.0M
</span></span></span></code></pre></td></tr></table></div></div><h2 id=freedom-through-constraints>Freedom Through Constraints</h2><p>The more I dive into Domain Driven Design with F#, the more I love it. By ensuring values comply with expectations at the boundary of the domain, I am freed to reason about my algorithms without worrying about data going awry inside the domain. While it takes a few more keystrokes to define operations on these domain types, I hope that I showed you that it takes little effort in F# and can lead to more reliable and robust code. Keep calm and curry on!</p></div><div id=comments></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.107.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=matthewcrews.com target=_blank>Matthew Crews</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"PASDMWALPK",algoliaIndex:"index.en",algoliaSearchKey:"b42948e51daaa93df92381c8e2ac0f93",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>